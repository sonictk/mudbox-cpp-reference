<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="MOBPRO" name="product"/><meta content="2018" name="release"/><meta content="GeneralUser" name="book"/><meta content="2017-09-08" name="created"/><meta content="GUID-02FA7DD3-6C7A-4C6A-B7BC-824765AE1CB2" name="topicid"/><meta content="concept" name="topic-type"/>
<title>SampleViewportFilter/SampleViewportFilter.cpp</title>
</head>
<body height="100%"><div class="body_content" id="body-content"><link href="../style/navtree.css" rel="stylesheet" type="text/css"/><link href="../style/doxygen.css" rel="stylesheet" type="text/css"/><link href="../style/tabs.css" rel="stylesheet" type="text/css"/><link href="../style/adsk.cpm.css" rel="stylesheet" type="text/css"/><script language="javascript">var index = 'index.html';</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });</script><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('_sample_viewport_filter_2_sample_viewport_filter_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->

<div>
<div class="head">
<h1>SampleViewportFilter/SampleViewportFilter.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./files.html"><span>Files</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">SampleViewportFilter/SampleViewportFilter.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"><span class="comment">// Copyright (c) 2008 Autodesk, Inc.</span></div>
<div class="line"><span class="comment">// All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk license</span></div>
<div class="line"><span class="comment">// agreement provided at the time of installation or download, or which</span></div>
<div class="line"><span class="comment">// otherwise accompanies this software in either electronic or hard copy form.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">// CREATED: October 2008</span></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define _USE_MATH_DEFINES</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include "SampleViewportFilter.h"</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;QtCore/QDir&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="./namespacemudbox.html">mudbox</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Filter plugin macros</span></div>
<div class="line"><a name="a0"></a><a class="code" href="./node_8h.html#aecde0e72e97a2b7e7589fadde661f9f8">IMPLEMENT_VCLASS</a>( SampleViewPortFilter, <a name="_a1"></a><a class="code" href="./classmudbox_1_1_view_port_filter.html">ViewPortFilter</a>, <span class="stringliteral">"Sample Viewport Filter"</span>, 1 );</div>
<div class="line"></div>
<div class="line"><a name="a2"></a><a class="code" href="./mudbox_8h.html#afa2df46a730e8fc8bceb9410c0ff6838">MB_PLUGIN</a>( <span class="stringliteral">"Sample Filter"</span>, <span class="stringliteral">"Sample Viewport Filter"</span>, <span class="stringliteral">"Autodesk"</span>, <span class="stringliteral">"http://www.mudbox3d.com"</span>, 0 );</div>
<div class="line"></div>
<div class="line"><span class="comment">// Render texture to screen to activate shaders.</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> drawFullScreenQuad() {</div>
<div class="line">    glMatrixMode( GL_PROJECTION );</div>
<div class="line">    glLoadIdentity();</div>
<div class="line">    glMatrixMode( GL_MODELVIEW );</div>
<div class="line">    glLoadIdentity();</div>
<div class="line"></div>
<div class="line">    glBegin( GL_QUADS );</div>
<div class="line"></div>
<div class="line">    glTexCoord2f( 0, 0 );</div>
<div class="line">    glVertex2f( -1, -1 );</div>
<div class="line"></div>
<div class="line">    glTexCoord2f( 1, 0 );</div>
<div class="line">    glVertex2f( 1, -1 );</div>
<div class="line"></div>
<div class="line">    glTexCoord2f( 1, 1 );</div>
<div class="line">    glVertex2f( 1, 1 );</div>
<div class="line"></div>
<div class="line">    glTexCoord2f( 0, 1 );</div>
<div class="line">    glVertex2f( -1, 1 );</div>
<div class="line"></div>
<div class="line">    glEnd();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Renders full screens quad to texture specified</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> gpuTransform(<a name="_a3"></a><a class="code" href="./classmudbox_1_1_texture.html">Texture</a>* <span class="keyword">const</span> outputTexture) {</div>
<div class="line">    outputTexture-&gt;<a name="a4"></a><a class="code" href="./classmudbox_1_1_texture.html#a41873174bff2734308a77c41e7e8155f">SetAsRenderTarget</a>();</div>
<div class="line">    drawFullScreenQuad();</div>
<div class="line">    outputTexture-&gt;<a name="a5"></a><a class="code" href="./classmudbox_1_1_texture.html#ac6369fcbfe41f3f512fde009417afca3">RestoreRenderTarget</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SampleViewPortFilter::OnNodeEvent( <span class="keyword">const</span> <a name="_a6"></a><a class="code" href="./structmudbox_1_1_attribute.html">Attribute</a> &amp;cAttribute, <a class="code" href="./namespacemudbox.html#a8d88d2a841f889dace76ffcd8d6b06da">NodeEventType</a> eType ) {</div>
<div class="line"> <span class="keywordflow">if</span>(eType == <a name="a7"></a><a class="code" href="./namespacemudbox.html#a8d88d2a841f889dace76ffcd8d6b06daa274758890f9a27906be7336f4b8e4780">etValueChanged</a>) {</div>
<div class="line">        {</div>
<div class="line"> <a name="a8"></a><a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Redraw();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">SampleViewPortFilter::SampleViewPortFilter() :</div>
<div class="line">    m_aGaussianBlur(this, <span class="stringliteral">"Gaussian"</span>),</div>
<div class="line">    m_aBlurWidth(this, <span class="stringliteral">"Blur Width"</span>)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Cg context</span></div>
<div class="line">    m_CGContext = <a name="a9"></a><a class="code" href="./cg_8h.html#a0b6efcf2e6ec400396807af564143fac">cgCreateContext</a>();</div>
<div class="line"> <a name="a10"></a><a class="code" href="./cg_g_l_8h.html#afb1ddee9514b14767147f207f6419f59">cgGLSetDebugMode</a>( <a name="a11"></a><a class="code" href="./cg_8h.html#a2009460e44fe74cd92f9c13c2dd57592">CG_FALSE</a> );</div>
<div class="line"></div>
<div class="line"> <a name="a12"></a><a class="code" href="./cg_g_l_8h.html#a9f4181ed02fc82e05d49efb8dd097e49">cgGLSetManageTextureParameters</a>(m_CGContext, <a name="a13"></a><a class="code" href="./cg_8h.html#a251a5b14a42fb7b64e82d0773ec94833">CG_TRUE</a>);</div>
<div class="line"> <a name="a14"></a><a class="code" href="./cg_8h.html#adab6bc9b4d1a3225608f15e14e11a668">cgSetParameterSettingMode</a>(m_CGContext, <a name="a15"></a><a class="code" href="./cg_8h.html#a58a98d9f87c901fb6636d2756c5a18e6a108eac62fd8ebf2ebdd92ac3af2f84e2">CG_DEFERRED_PARAMETER_SETTING</a>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">/* Compile and load the vertex program. */</span></div>
<div class="line">    m_FragmentProfile = <a name="a16"></a><a class="code" href="./cg_g_l_8h.html#ab20fd18cf7d726beaa9d7c36193c2a61">cgGLGetLatestProfile</a>(<a name="a17"></a><a class="code" href="./cg_g_l_8h.html#ad83071d7f7686bc85d28e22f1cb814afad69b6ec26c2fe834fae9a07f10be8104">CG_GL_FRAGMENT</a>);</div>
<div class="line"> <a name="a18"></a><a class="code" href="./cg_g_l_8h.html#a21d2a26b50cce15f370d937c0172911c">cgGLSetOptimalOptions</a>(m_FragmentProfile);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Get the path to where the plug-in was loaded from</span></div>
<div class="line"> <a name="_a19"></a><a class="code" href="./class_q_dir.html">QDir</a> pluginDir( <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;PluginDirectory(<span class="stringliteral">"Sample Filter"</span>) );</div>
<div class="line"> <a name="_a20"></a><a class="code" href="./class_q_file_info.html">QFileInfo</a> cgPath( pluginDir, <a name="_a21"></a><a class="code" href="./class_q_string.html">QString</a>(<span class="stringliteral">"Blur.cg"</span>) );</div>
<div class="line"></div>
<div class="line"> <span class="comment">/* Compile and load the fragment program. */</span></div>
<div class="line"> <a name="_a22"></a><a class="code" href="./class_q_byte_array.html">QByteArray</a> qbaPath = <a name="a23"></a><a class="code" href="./class_q_file.html#a548ef3f34e5265ca50980914ccabbfde">QFile::encodeName</a>(cgPath.filePath());</div>
<div class="line">    m_BlurProgram =</div>
<div class="line"> <a name="a24"></a><a class="code" href="./cg_8h.html#ad11c69fae9409d44ff1494e57b620928">cgCreateProgramFromFile</a>(</div>
<div class="line">        m_CGContext,                <span class="comment">/* Cg runtime context */</span></div>
<div class="line"> <a name="a25"></a><a class="code" href="./cg_8h.html#a58a98d9f87c901fb6636d2756c5a18e6a8a81af23c02a7a32e5dfd0ca6dd83dec">CG_SOURCE</a>,                  <span class="comment">/* Program in human-readable form */</span></div>
<div class="line">        qbaPath.<a name="a26"></a><a class="code" href="./class_q_byte_array.html#acd2173722996016205933aa3053f895f">constData</a>(), <span class="comment">/* Name of file containing program */</span></div>
<div class="line">        m_FragmentProfile,<span class="comment">/* Profile: OpenGL ARB vertex program */</span></div>
<div class="line"> <span class="stringliteral">"main"</span>,      <span class="comment">/* Entry function name */</span></div>
<div class="line">        NULL);                      <span class="comment">/* No extra compiler options */</span></div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> ( m_BlurProgram == NULL ) <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Interface()-&gt;HUDMessageShow(<span class="stringliteral">"Failed to load Blur.cg"</span>, <a name="a27"></a><a class="code" href="./classmudbox_1_1_interface.html#a26e31204f799b1a1db85565fc5a98b99a6d1628d017e93eb59b9a74b0cdc9d904">mudbox::Interface::HUDmsgFade</a> );</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"> <a name="a28"></a><a class="code" href="./cg_g_l_8h.html#a3fdd0cf6161407c251ff13b7b31b470e">cgGLLoadProgram</a>(m_BlurProgram);</div>
<div class="line"></div>
<div class="line">    m_BlurColorTextureParam = <a name="a29"></a><a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_BlurProgram, <span class="stringliteral">"colorTexture"</span>);</div>
<div class="line">    m_BlurWidthParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_BlurProgram, <span class="stringliteral">"BlurWidth"</span>);</div>
<div class="line">    m_GaussianBlurParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_BlurProgram, <span class="stringliteral">"GaussianBlur"</span>);</div>
<div class="line"></div>
<div class="line">    m_aGaussianBlur = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">    m_aBlurWidth.SetMax(.0050<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>);</div>
<div class="line">    m_aBlurWidth.SetMin(.0001<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>);</div>
<div class="line">    m_aBlurWidth = 0.0012f;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Create the output texture</span></div>
<div class="line">    m_pResultTexture = CreateInstance&lt;Texture&gt;();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">SampleViewPortFilter::~SampleViewPortFilter()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span>( m_pResultTexture )</div>
<div class="line"> <span class="keyword">delete</span> m_pResultTexture;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (m_CGContext)</div>
<div class="line"> <a name="a30"></a><a class="code" href="./cg_8h.html#aac74f65897d67c949df16b85475dca16">cgDestroyContext</a>(m_CGContext);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SampleViewPortFilter::Process( <a name="_a31"></a><a class="code" href="./structmudbox_1_1_view_port_state.html">ViewPortState</a> &amp;<a class="code" href="./_g_lee_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a> ) </div>
<div class="line">{</div>
<div class="line"> <span class="keyword">enum</span> <a class="code" href="./classmudbox_1_1_image.html#ab4e88c89b3b7ea1735996cc4def22d58">Image::Format</a> eFormat = s.<a name="a32"></a><a class="code" href="./structmudbox_1_1_view_port_state.html#a8a0afc3ff3c1117eea3ccb3f70884218">m_bHDRNeeded</a> ? Image::e16float : Image::e8integer;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set of variables not actually used for anything other than to show</span></div>
<div class="line"> <span class="comment">// how to access the values.</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraNear = <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;ActiveCamera()-&gt;Near();</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraFar = <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;ActiveCamera()-&gt;Far();</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraFOV = <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;ActiveCamera()-&gt;FOV();</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraAspectRatio = <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;ActiveCamera()-&gt;AspectRatio();</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraHeight = tanf(cameraFOV / 2.0<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>) * cameraNear;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraWidth = cameraHeight * cameraAspectRatio;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraTop = -cameraHeight;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraBottom = cameraHeight;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraLeft = -cameraWidth;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> cameraRight = cameraWidth;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Ensure our output texture is same size &amp; type as the incoming color buffer.</span></div>
<div class="line"> <span class="comment">// Get width and height of the viewport</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="./_g_lee_8h.html#ac112eef468530a44b7a653ddac190a22">width</a> = s.<a name="a33"></a><a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a>-&gt;<a name="a34"></a><a class="code" href="./classmudbox_1_1_texture.html#a9fb8594edb54f6768c9c255e82b64e55">Width</a>();</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="./_g_lee_8h.html#ab375df5e95c5fc63fc9165319162bddc">height</a> = s.<a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a>-&gt;<a name="a35"></a><a class="code" href="./classmudbox_1_1_texture.html#a2bf08b44fad2ec32cf410195eacb60b2">Height</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Smallest of width and height</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">int</span> extendMin = width &lt; height ? width : <a name="a36"></a><a class="code" href="./_g_lee_8h.html#ab375df5e95c5fc63fc9165319162bddc">height</a>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Logarithm of the SMALLER extend, in order to be at least 1 pixel in size in any dimension</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">int</span> levelCountMax = (<a name="a37"></a><a class="code" href="./_g_lee_8h.html#aa813ad7a4a00cda401ffd0c336154620">int</a>)floorf(logf(<span class="keywordtype">float</span>(extendMin)) / float(M_LN2));</div>
<div class="line"></div>
<div class="line"> <span class="comment">// See if the input size or format changed. If so, re-create the texture.</span></div>
<div class="line"> <span class="keywordflow">if</span>( m_pResultTexture-&gt;Width() != s.<a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a>-&gt;<a class="code" href="./classmudbox_1_1_texture.html#a9fb8594edb54f6768c9c255e82b64e55">Width</a>() || </div>
<div class="line">        m_pResultTexture-&gt;Height() != s.<a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a>-&gt;<a class="code" href="./classmudbox_1_1_texture.html#a2bf08b44fad2ec32cf410195eacb60b2">Height</a>())</div>
<div class="line">    {</div>
<div class="line">        m_pResultTexture-&gt;Create(s.<a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a>-&gt;<a class="code" href="./classmudbox_1_1_texture.html#a9fb8594edb54f6768c9c255e82b64e55">Width</a>(), s.<a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a>-&gt;<a class="code" href="./classmudbox_1_1_texture.html#a2bf08b44fad2ec32cf410195eacb60b2">Height</a>(), 4, eFormat);</div>
<div class="line">    };</div>
<div class="line">    m_pResultTexture-&gt;SetLocation( TexturePool::locationGPU );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Enable Cg fragment profile</span></div>
<div class="line"> <a name="a38"></a><a class="code" href="./cg_g_l_8h.html#a26c714fcbbf139071a5eb37ecffd4cbe">cgGLEnableProfile</a>(m_FragmentProfile);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set up some gl states</span></div>
<div class="line">    glDisable(<a name="a39"></a><a class="code" href="./qglfunctions_8h.html#a4ccf1dc093190cc3798b9abea3655f98">GL_DEPTH_TEST</a>);</div>
<div class="line">    glDisable(<a name="a40"></a><a class="code" href="./qglfunctions_8h.html#aa290e8f9ee6f6862778355aa22bb0b13">GL_BLEND</a>);</div>
<div class="line">    glDisable(<a name="a41"></a><a class="code" href="./qglfunctions_8h.html#a8c4f153ed20a741aaae952650fec46f0">GL_CULL_FACE</a>);</div>
<div class="line"></div>
<div class="line"> <a name="a42"></a><a class="code" href="./cg_g_l_8h.html#a5a566921e13982a1add1b7874d0b9d5d">cgGLBindProgram</a>(m_BlurProgram);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set the incoming color buffer on the shader</span></div>
<div class="line"> <a name="a43"></a><a class="code" href="./cg_g_l_8h.html#ac206ad0a97a994acdcd2558bbfce6216">cgGLSetTextureParameter</a>(m_BlurColorTextureParam, s.<a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a>-&gt;<a name="a44"></a><a class="code" href="./classmudbox_1_1_texture.html#aac5b5c6c3637542f2f4d78336386b6a5">OpenGLName</a>());</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set blur width value</span></div>
<div class="line"> <a name="a45"></a><a class="code" href="./cg_8h.html#a39b31fb362aa2f4d0dbee3a2267c547f">cgSetParameter1f</a>(m_BlurWidthParam, m_aBlurWidth);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set Gaussian usage value</span></div>
<div class="line"> <a name="a46"></a><a class="code" href="./cg_8h.html#a7e92d50ef2447388aeb30069fe47fad0">cgSetParameter1i</a>(m_GaussianBlurParam, m_aGaussianBlur);</div>
<div class="line"></div>
<div class="line"> <a name="a47"></a><a class="code" href="./cg_8h.html#ab852a46031bb7d6d62e2348cd88ebd22">cgUpdateProgramParameters</a>(m_BlurProgram);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Render to the resulting texture.  This activates the shader pass.</span></div>
<div class="line">    gpuTransform(m_pResultTexture);</div>
<div class="line"> </div>
<div class="line"> <a name="a48"></a><a class="code" href="./cg_g_l_8h.html#afbf63baab60050650f15576b8161c689">cgGLDisableProfile</a>(m_FragmentProfile);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Assign the resulting texture to the color buffer</span></div>
<div class="line">    s.<a class="code" href="./structmudbox_1_1_view_port_state.html#a462d3523d369eeef2f857b9027777452">m_pColor</a> = m_pResultTexture;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SampleViewPortFilter::SetVisible( <span class="keywordtype">bool</span> bVisible )</div>
<div class="line">{</div>
<div class="line">    ViewPortFilter::SetVisible( bVisible );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( bVisible )</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span>( !m_pResultTexture )</div>
<div class="line">            m_pResultTexture = CreateInstance&lt;Texture&gt;();</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">delete</span> m_pResultTexture;</div>
<div class="line">        m_pResultTexture = 0;</div>
<div class="line">    };</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
</div></body>
</html>
