<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="MOBPRO" name="product"/><meta content="2018" name="release"/><meta content="GeneralUser" name="book"/><meta content="2017-09-08" name="created"/><meta content="GUID-02FA7DD3-6C7A-4C6A-B7BC-824765AE1CB2" name="topicid"/><meta content="concept" name="topic-type"/>
<title>ToonMaterial/ToonMaterial.cpp</title>
</head>
<body height="100%"><div class="body_content" id="body-content"><link href="../style/navtree.css" rel="stylesheet" type="text/css"/><link href="../style/doxygen.css" rel="stylesheet" type="text/css"/><link href="../style/tabs.css" rel="stylesheet" type="text/css"/><link href="../style/adsk.cpm.css" rel="stylesheet" type="text/css"/><script language="javascript">var index = 'index.html';</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });</script><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('_toon_material_2_toon_material_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->

<div>
<div class="head">
<h1>ToonMaterial/ToonMaterial.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./files.html"><span>Files</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">ToonMaterial/ToonMaterial.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"><span class="comment">// Copyright (c) 2008 Autodesk, Inc.</span></div>
<div class="line"><span class="comment">// All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk license</span></div>
<div class="line"><span class="comment">// agreement provided at the time of installation or download, or which</span></div>
<div class="line"><span class="comment">// otherwise accompanies this software in either electronic or hard copy form.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">// CREATED: October 2008</span></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include "ToonMaterial.h"</span></div>
<div class="line"><span class="preprocessor">#include &lt;QtCore/QDir&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// NOTE : This plugin does not have any exception handling.  This was done</span></div>
<div class="line"><span class="comment">// for brevity reasons.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Plugin registration macros</span></div>
<div class="line"><a name="a0"></a><a class="code" href="./mudbox_8h.html#afa2df46a730e8fc8bceb9410c0ff6838">MB_PLUGIN</a>( <span class="stringliteral">"ToonMaterial"</span>, <span class="stringliteral">"Toon material"</span>, <span class="stringliteral">"Autodesk"</span>, <span class="stringliteral">"http://www.mudbox3d.com"</span>, 0 );</div>
<div class="line"></div>
<div class="line"><a name="a1"></a><a class="code" href="./node_8h.html#a1d51ad935ab5d26fe95dff62601b602c">IMPLEMENT_CLASS</a>( ToonMaterial, Material, <span class="stringliteral">"Toon Material"</span> );</div>
<div class="line"></div>
<div class="line"><span class="comment">// forward declarations</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">float</span> diffuseRamp(<span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">float</span> specularRamp(<span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">float</span> edgeRamp(<span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> loadRamp(<a name="a2"></a><a class="code" href="./_g_lee_8h.html#a852415b1bb59365d80357c5f33e816c5">GLuint</a> texobj, <span class="keywordtype">int</span> <a class="code" href="./_g_lee_8h.html#a8f853268a6a93ade1ff556b79420cda3">size</a>, <span class="keywordtype">float</span> (*func)(<span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>));</div>
<div class="line"></div>
<div class="line">ToonMaterial::ToonMaterial( <span class="keywordtype">void</span> ) :</div>
<div class="line">            m_aKd(this, <span class="stringliteral">"Kd"</span>),</div>
<div class="line">            m_aKs(this, <span class="stringliteral">"Ks"</span>),</div>
<div class="line">            m_aShininess(this, <span class="stringliteral">"Shiny"</span>)</div>
<div class="line">{</div>
<div class="line">    SetName( <span class="stringliteral">"Toon Material"</span> );</div>
<div class="line"></div>
<div class="line">    m_CGContext = <a name="a3"></a><a class="code" href="./cg_8h.html#a0b6efcf2e6ec400396807af564143fac">cgCreateContext</a>();</div>
<div class="line"> <a name="a4"></a><a class="code" href="./cg_g_l_8h.html#afb1ddee9514b14767147f207f6419f59">cgGLSetDebugMode</a>( <a name="a5"></a><a class="code" href="./cg_8h.html#a2009460e44fe74cd92f9c13c2dd57592">CG_FALSE</a> );</div>
<div class="line"> </div>
<div class="line"> <a name="a6"></a><a class="code" href="./cg_g_l_8h.html#a9f4181ed02fc82e05d49efb8dd097e49">cgGLSetManageTextureParameters</a>(m_CGContext, <a name="a7"></a><a class="code" href="./cg_8h.html#a251a5b14a42fb7b64e82d0773ec94833">CG_TRUE</a>);</div>
<div class="line"> <a name="a8"></a><a class="code" href="./cg_8h.html#adab6bc9b4d1a3225608f15e14e11a668">cgSetParameterSettingMode</a>(m_CGContext, <a name="a9"></a><a class="code" href="./cg_8h.html#a58a98d9f87c901fb6636d2756c5a18e6a108eac62fd8ebf2ebdd92ac3af2f84e2">CG_DEFERRED_PARAMETER_SETTING</a>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">/* Compile and load the vertex program. */</span></div>
<div class="line">    m_VertexProfile = <a name="a10"></a><a class="code" href="./cg_g_l_8h.html#ab20fd18cf7d726beaa9d7c36193c2a61">cgGLGetLatestProfile</a>(<a name="a11"></a><a class="code" href="./cg_g_l_8h.html#ad83071d7f7686bc85d28e22f1cb814afa33615e596fd493317631f9414afc42a7">CG_GL_VERTEX</a>);</div>
<div class="line"> <a name="a12"></a><a class="code" href="./cg_g_l_8h.html#a21d2a26b50cce15f370d937c0172911c">cgGLSetOptimalOptions</a>(m_VertexProfile);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Get the path to where the plug-in was loaded from</span></div>
<div class="line"> <a name="_a13"></a><a class="code" href="./class_q_dir.html">QDir</a> pluginDir( <a name="a14"></a><a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;PluginDirectory(<span class="stringliteral">"ToonMaterial"</span>) );</div>
<div class="line"> <a name="_a15"></a><a class="code" href="./class_q_file_info.html">QFileInfo</a> vertexPath( pluginDir, <a name="_a16"></a><a class="code" href="./class_q_string.html">QString</a>(<span class="stringliteral">"toon_vertex.cg"</span>) );</div>
<div class="line"> <a class="code" href="./class_q_file_info.html">QFileInfo</a> fragmentPath( pluginDir, <a class="code" href="./class_q_string.html">QString</a>(<span class="stringliteral">"toon_fragment.cg"</span>) );</div>
<div class="line"></div>
<div class="line"> <a name="_a17"></a><a class="code" href="./class_q_byte_array.html">QByteArray</a> qbaVertexPath = <a name="a18"></a><a class="code" href="./class_q_file.html#a548ef3f34e5265ca50980914ccabbfde">QFile::encodeName</a>(vertexPath.filePath());</div>
<div class="line">    m_VertexProgram =</div>
<div class="line"> <a name="a19"></a><a class="code" href="./cg_8h.html#ad11c69fae9409d44ff1494e57b620928">cgCreateProgramFromFile</a>(</div>
<div class="line">          m_CGContext,              <span class="comment">/* Cg runtime context */</span></div>
<div class="line"> <a name="a20"></a><a class="code" href="./cg_8h.html#a58a98d9f87c901fb6636d2756c5a18e6a8a81af23c02a7a32e5dfd0ca6dd83dec">CG_SOURCE</a>,                <span class="comment">/* Program in human-readable form */</span></div>
<div class="line">          qbaVertexPath.<a name="a21"></a><a class="code" href="./class_q_byte_array.html#acd2173722996016205933aa3053f895f">constData</a>(),  <span class="comment">/* Name of file containing program */</span></div>
<div class="line">          m_VertexProfile,        <span class="comment">/* Profile: OpenGL ARB vertex program */</span></div>
<div class="line"> <span class="stringliteral">"main"</span>,      <span class="comment">/* Entry function name */</span></div>
<div class="line">          NULL);                    <span class="comment">/* No extra commyPiler options */</span></div>
<div class="line"></div>
<div class="line"> <a name="a22"></a><a class="code" href="./cg_g_l_8h.html#a3fdd0cf6161407c251ff13b7b31b470e">cgGLLoadProgram</a>(m_VertexProgram);</div>
<div class="line"></div>
<div class="line">    m_ModelViewProjParam = <a name="a23"></a><a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_VertexProgram, <span class="stringliteral">"modelViewProj"</span>);</div>
<div class="line">    m_LightPositionParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_VertexProgram, <span class="stringliteral">"lightPosition"</span>);</div>
<div class="line">    m_EyePositionParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_VertexProgram, <span class="stringliteral">"eyePosition"</span>);</div>
<div class="line">    m_ShininessParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_VertexProgram, <span class="stringliteral">"shininess"</span>);</div>
<div class="line"></div>
<div class="line">    m_FragmentProfile = <a class="code" href="./cg_g_l_8h.html#ab20fd18cf7d726beaa9d7c36193c2a61">cgGLGetLatestProfile</a>(<a name="a24"></a><a class="code" href="./cg_g_l_8h.html#ad83071d7f7686bc85d28e22f1cb814afad69b6ec26c2fe834fae9a07f10be8104">CG_GL_FRAGMENT</a>);</div>
<div class="line"> <a class="code" href="./cg_g_l_8h.html#a21d2a26b50cce15f370d937c0172911c">cgGLSetOptimalOptions</a>(m_FragmentProfile);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">/* Compile and load the fragment program. */</span></div>
<div class="line"> <a class="code" href="./class_q_byte_array.html">QByteArray</a> qbaFragmentPath = <a class="code" href="./class_q_file.html#a548ef3f34e5265ca50980914ccabbfde">QFile::encodeName</a>(fragmentPath.filePath());</div>
<div class="line">    m_FragmentProgram =</div>
<div class="line"> <a class="code" href="./cg_8h.html#ad11c69fae9409d44ff1494e57b620928">cgCreateProgramFromFile</a>(</div>
<div class="line">          m_CGContext,                <span class="comment">/* Cg runtime context */</span></div>
<div class="line"> <a class="code" href="./cg_8h.html#a58a98d9f87c901fb6636d2756c5a18e6a8a81af23c02a7a32e5dfd0ca6dd83dec">CG_SOURCE</a>,                  <span class="comment">/* Program in human-readable form */</span></div>
<div class="line">          qbaFragmentPath.<a class="code" href="./class_q_byte_array.html#acd2173722996016205933aa3053f895f">constData</a>(),  <span class="comment">/* Name of file containing program */</span></div>
<div class="line">          m_FragmentProfile,        <span class="comment">/* Profile: OpenGL ARB vertex program */</span></div>
<div class="line"> <span class="stringliteral">"main"</span>,      <span class="comment">/* Entry function name */</span></div>
<div class="line">          NULL);                      <span class="comment">/* No extra compiler options */</span></div>
<div class="line"></div>
<div class="line"> <a class="code" href="./cg_g_l_8h.html#a3fdd0cf6161407c251ff13b7b31b470e">cgGLLoadProgram</a>(m_FragmentProgram);</div>
<div class="line"></div>
<div class="line">    m_KdParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_FragmentProgram, <span class="stringliteral">"Kd"</span>);</div>
<div class="line">    m_KsParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_FragmentProgram, <span class="stringliteral">"Ks"</span>);</div>
<div class="line"></div>
<div class="line">    m_DiffuseRampParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_FragmentProgram, <span class="stringliteral">"diffuseRamp"</span>);</div>
<div class="line">    m_SpecularRampParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_FragmentProgram, <span class="stringliteral">"specularRamp"</span>);</div>
<div class="line">    m_EdgeRampParam = <a class="code" href="./cg_8h.html#aba225f7d8a697845c0054482492f6312">cgGetNamedParameter</a>(m_FragmentProgram, <span class="stringliteral">"edgeRamp"</span>);</div>
<div class="line"></div>
<div class="line">    glGenTextures(1, &amp;m_iDiffuseRamp); <span class="comment">// m_iDiffuseRamp = 1;</span></div>
<div class="line">    loadRamp(m_iDiffuseRamp, 255, diffuseRamp);</div>
<div class="line"> <a name="a25"></a><a class="code" href="./cg_g_l_8h.html#ac206ad0a97a994acdcd2558bbfce6216">cgGLSetTextureParameter</a>(m_DiffuseRampParam, m_iDiffuseRamp);</div>
<div class="line"></div>
<div class="line">    glGenTextures(1, &amp;m_iSpecularRamp); <span class="comment">// m_iSpecularRamp = 2;</span></div>
<div class="line">    loadRamp(m_iSpecularRamp, 255, specularRamp);</div>
<div class="line"> <a class="code" href="./cg_g_l_8h.html#ac206ad0a97a994acdcd2558bbfce6216">cgGLSetTextureParameter</a>(m_SpecularRampParam, m_iSpecularRamp);</div>
<div class="line"></div>
<div class="line">    glGenTextures(1, &amp;m_iEdgeRamp); <span class="comment">// m_iEdgeRamp = 3;</span></div>
<div class="line">    loadRamp(m_iEdgeRamp, 255, edgeRamp);</div>
<div class="line"> <a class="code" href="./cg_g_l_8h.html#ac206ad0a97a994acdcd2558bbfce6216">cgGLSetTextureParameter</a>(m_EdgeRampParam, m_iEdgeRamp);</div>
<div class="line"></div>
<div class="line">    m_aKd = Color(0.8<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>, 0.6<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>, 0.2<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>, 1.0<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>);</div>
<div class="line">    m_aKs = Color(0.3<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>, 0.3<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>, 4.0<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>, 0.0<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set min &amp; max of shininess slider.</span></div>
<div class="line">    m_aShininess.SetMax(25);</div>
<div class="line">    m_aShininess.SetMin(1);</div>
<div class="line"></div>
<div class="line">    m_aShininess = 5.2f;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">ToonMaterial::~ToonMaterial( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// This destroys all programs as well</span></div>
<div class="line"> <a name="a26"></a><a class="code" href="./cg_8h.html#aac74f65897d67c949df16b85475dca16">cgDestroyContext</a>(m_CGContext);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Clean up</span></div>
<div class="line">    glDeleteTextures(1, &amp;m_iDiffuseRamp);</div>
<div class="line">    glDeleteTextures(1, &amp;m_iSpecularRamp);</div>
<div class="line">    glDeleteTextures(1, &amp;m_iEdgeRamp);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> ToonMaterial::Activate( <span class="keyword">const</span> Mesh *pMesh, <span class="keyword">const</span> AxisAlignedBoundingBox &amp;cUVArea, <span class="keyword">const</span> Color &amp;cColor )</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span> (!pMesh)</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Enable the profiles</span></div>
<div class="line"> <a name="a27"></a><a class="code" href="./cg_g_l_8h.html#a26c714fcbbf139071a5eb37ecffd4cbe">cgGLEnableProfile</a>(m_VertexProfile);</div>
<div class="line"> <a class="code" href="./cg_g_l_8h.html#a26c714fcbbf139071a5eb37ecffd4cbe">cgGLEnableProfile</a>(m_FragmentProfile);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Bind the programs</span></div>
<div class="line"> <a name="a28"></a><a class="code" href="./cg_g_l_8h.html#a5a566921e13982a1add1b7874d0b9d5d">cgGLBindProgram</a>(m_VertexProgram);</div>
<div class="line"> <a class="code" href="./cg_g_l_8h.html#a5a566921e13982a1add1b7874d0b9d5d">cgGLBindProgram</a>(m_FragmentProgram);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Ordinarily you'd want to only set these values if they change.  For</span></div>
<div class="line"> <span class="comment">// this sample we'll just set them here.</span></div>
<div class="line"></div>
<div class="line"> <a name="a29"></a><a class="code" href="./cg_8h.html#ae55ef4922e2b8566b51ff38709edad9b">cgSetParameter4fv</a>(m_KdParam, m_aKd.Value());</div>
<div class="line"> <a class="code" href="./cg_8h.html#ae55ef4922e2b8566b51ff38709edad9b">cgSetParameter4fv</a>(m_KsParam, m_aKs.Value());</div>
<div class="line"> <a name="a30"></a><a class="code" href="./cg_8h.html#a39b31fb362aa2f4d0dbee3a2267c547f">cgSetParameter1f</a>(m_ShininessParam, m_aShininess.Value());</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set the light on the shader.</span></div>
<div class="line"> <span class="comment">// Mudbox supports both point &amp; directional lights.  If</span></div>
<div class="line"> <span class="comment">// the first light is directional we'll push it out from</span></div>
<div class="line"> <span class="comment">// the origin.  The shader assumes point light</span></div>
<div class="line"> <span class="keywordflow">if</span> (<a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;LightCount())</div>
<div class="line">    {</div>
<div class="line">        Light *pLight = <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;Light(0);</div>
<div class="line">        Vector <a name="a31"></a><a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a>(0,0,1);</div>
<div class="line"> <span class="keywordflow">if</span> (pLight-&gt;Type() == Light::LIGHT_POINT)</div>
<div class="line">        {</div>
<div class="line"> <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a> = pLight-&gt;Transformation()-&gt;Position();</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pLight-&gt;Type() == Light::LIGHT_DIRECTIONAL)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">if</span> (pLight-&gt;IsLockedToCamera())</div>
<div class="line"> <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a> = pLight-&gt;LockedToCameraMatrix().Transform(<a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a>);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line"> <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a> = pLight-&gt;Transformation()-&gt;WorldToLocalMatrix().Invert().Transform(<a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a>);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a>.Normalize();</div>
<div class="line"> <span class="comment">// Scoot this away from the origin to give it the appearance of a</span></div>
<div class="line"> <span class="comment">// point light.</span></div>
<div class="line"> <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a>*=100;</div>
<div class="line">        }</div>
<div class="line"> <a name="a32"></a><a class="code" href="./cg_8h.html#a7ccb04b29610ce2f76878a1eddbd6907">cgSetParameter3fv</a>(m_LightPositionParam, <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./cg_8h.html#a7ccb04b29610ce2f76878a1eddbd6907">cgSetParameter3fv</a>(m_EyePositionParam, <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;ActiveCamera()-&gt;Position());</div>
<div class="line"></div>
<div class="line">    Matrix mModelViewProj = pMesh-&gt;Geometry()-&gt;Transformation()-&gt;LocalToWorldMatrix()*<a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Scene()-&gt;ActiveCamera()-&gt;Matrix(<span class="keyword">true</span>);</div>
<div class="line"> <a name="a33"></a><a class="code" href="./cg_8h.html#a4e99c0807b9c40c07706adc144723a31">cgSetParameterValuefc</a>(m_ModelViewProjParam, 16, mModelViewProj);</div>
<div class="line"></div>
<div class="line"> <a name="a34"></a><a class="code" href="./cg_8h.html#ab852a46031bb7d6d62e2348cd88ebd22">cgUpdateProgramParameters</a>(m_VertexProgram);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> ToonMaterial::Deactivate( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line"> <a name="a35"></a><a class="code" href="./cg_g_l_8h.html#afbf63baab60050650f15576b8161c689">cgGLDisableProfile</a>(m_VertexProfile);</div>
<div class="line"> <a class="code" href="./cg_g_l_8h.html#afbf63baab60050650f15576b8161c689">cgGLDisableProfile</a>(m_FragmentProfile);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> ToonMaterial::OnNodeEvent( <span class="keyword">const</span> Attribute &amp;cAttribute, <a name="a36"></a><a class="code" href="./namespacemudbox.html#a8d88d2a841f889dace76ffcd8d6b06da">NodeEventType</a> cType )</div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">bool</span> bRedraw = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>(cType == <a name="a37"></a><a class="code" href="./namespacemudbox.html#a8d88d2a841f889dace76ffcd8d6b06daa274758890f9a27906be7336f4b8e4780">etValueChanged</a>)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (cAttribute == m_aKs ||</div>
<div class="line">            cAttribute == m_aKd ||</div>
<div class="line">            cAttribute == m_aShininess)</div>
<div class="line">            bRedraw = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    Material::OnNodeEvent( cAttribute, cType );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (bRedraw)</div>
<div class="line"> <a class="code" href="./namespacemudbox.html#ae9df9ee935ec6744f98a1585d9db01df">Kernel</a>()-&gt;Redraw();</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Callback function for loadRamp */</span></div>
<div class="line"><span class="keywordtype">float</span> diffuseRamp(<span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span> (x &gt; 0.5) {</div>
<div class="line"> <span class="keywordflow">return</span> x*x*(3-2*<a name="a38"></a><a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line"> <span class="keywordflow">return</span> 0.5f;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Callback function for loadRamp */</span></div>
<div class="line"><span class="keywordtype">float</span> specularRamp(<span class="keywordtype">float</span> x)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span> (x &gt; 0.2<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>) {</div>
<div class="line"> <span class="keywordflow">return</span> <a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line"> <span class="keywordflow">return</span> 0.0f;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Callback function for loadRamp */</span></div>
<div class="line"><span class="keywordtype">float</span> edgeRamp(<span class="keywordtype">float</span> x)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span> (x &lt; 0.2<a class="code" href="./_g_lee_8h.html#a691492ec0bd6383f91200e49f6ae40ed">f</a>) {</div>
<div class="line"> <span class="keywordflow">return</span> 1.0f;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line"> <span class="keywordflow">return</span> 0.85f;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Create a 1D texture ramp by evaluating func over the range [0,1]. */</span></div>
<div class="line"><span class="keywordtype">void</span> loadRamp(<a class="code" href="./_g_lee_8h.html#a852415b1bb59365d80357c5f33e816c5">GLuint</a> texobj, <span class="keywordtype">int</span> size, <span class="keywordtype">float</span> (*func)(<span class="keywordtype">float</span> x))</div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">int</span> bytesForRamp = size*<span class="keyword">sizeof</span>(float);</div>
<div class="line"> <span class="keywordtype">float</span> *ramp = (<span class="keywordtype">float</span> *) malloc(bytesForRamp);</div>
<div class="line"> <span class="keywordtype">float</span> *slot = ramp;</div>
<div class="line"> <span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a33d2ecc01140a71bf38a16c8bf64dc18">dx</a> = 1.0f / (float) size;</div>
<div class="line"> <span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a09b61c9254503800358fe9680a997626">x</a>;</div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (i=0, x=0.0, slot=ramp; i&lt;<a name="a39"></a><a class="code" href="./_g_lee_8h.html#a8f853268a6a93ade1ff556b79420cda3">size</a>; i++, x += <a name="a40"></a><a class="code" href="./_g_lee_8h.html#a33d2ecc01140a71bf38a16c8bf64dc18">dx</a>, slot++) {</div>
<div class="line"> <span class="keywordtype">float</span> <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a> = func(x);</div>
<div class="line"></div>
<div class="line">        *slot = <a class="code" href="./_g_lee_8h.html#a14cfbe2fc2234f5504618905b69d1e06">v</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef GL_CLAMP_TO_EDGE</span></div>
<div class="line"><span class="preprocessor">#define GL_CLAMP_TO_EDGE                  0x812F  </span><span class="comment">/* Added by OpenGL 1.2 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    glBindTexture(GL_TEXTURE_1D, texobj);</div>
<div class="line">    glTexImage1D(GL_TEXTURE_1D, 0, GL_INTENSITY16, size, 0, <a name="a41"></a><a class="code" href="./qglfunctions_8h.html#a5ebfb7e4321ee2838cb17b10b8d44959">GL_LUMINANCE</a>, <a name="a42"></a><a class="code" href="./qglfunctions_8h.html#a6d19915d4237cb559505bd3e5dcfcf3c">GL_FLOAT</a>, ramp);</div>
<div class="line">    glTexParameteri(GL_TEXTURE_1D, <a name="a43"></a><a class="code" href="./qglfunctions_8h.html#a23a0bc2909cc2f79fe7287aaa044e880">GL_TEXTURE_WRAP_S</a>, <a name="a44"></a><a class="code" href="./_g_lee_8h.html#ae90f81f48642444b4ba7fa5cacf40569">GL_CLAMP_TO_EDGE</a>);</div>
<div class="line">    glTexParameteri(GL_TEXTURE_1D, <a name="a45"></a><a class="code" href="./qglfunctions_8h.html#acb47a41b5963d44826f44b7370bccc26">GL_TEXTURE_MAG_FILTER</a>, <a name="a46"></a><a class="code" href="./qglfunctions_8h.html#a4e682f218130b98b27a1e33fa7325080">GL_LINEAR</a>);</div>
<div class="line">    glTexParameteri(GL_TEXTURE_1D, <a name="a47"></a><a class="code" href="./qglfunctions_8h.html#a173a2b2453322dd8d613df6cf2e72480">GL_TEXTURE_MIN_FILTER</a>, <a class="code" href="./qglfunctions_8h.html#a4e682f218130b98b27a1e33fa7325080">GL_LINEAR</a>);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
</div></body>
</html>
